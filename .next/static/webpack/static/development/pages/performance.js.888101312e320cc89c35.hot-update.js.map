{"version":3,"file":"static/webpack/static/development/pages/performance.js.888101312e320cc89c35.hot-update.js","sources":["webpack:///./pages/performance.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Modal, Button, Select, Row, Col } from \"antd\";\n\nimport { chartData } from \"../utils/table\";\n\nimport Table from \"../components/table\";\nimport AdAccount from \"../components/adAccount\";\nimport { performanceColumns } from \"../utils/table\";\nimport { getAdAccounts, paginateAdAccounts } from \"../api/api\";\n\nfunction Performance(props) {\n  const [state, setState] = useState({\n    modalVisible: false,\n    selectedRowKeys: null,\n    paging: {\n      next: '',\n      previous: ''\n    },\n    selectedAdAccount: {}\n  });\n\n  const { fbId, user } = props;\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      console.log(\"on browser\");\n      const { Column } = require(\"@antv/g2plot\");\n\n      const chart = new Column(document.getElementById(\"chart\"), {\n        data: chartData,\n        xField: \"name\",\n        yField: \"value\",\n        padding: \"auto\",\n        title: {\n          visible: true,\n          text: \"Interest stats\"\n        },\n        forceFit: true\n      });\n      console.log(\"el\", document.getElementById(\"chart\"));\n      chart.render();\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchAdAccounts();\n  }, [state.modalVisible]);\n\n  const setModalVisible = modalVisible => {\n    setState({\n      ...state,\n      modalVisible\n    });\n  };\n\n  const fetchAdAccounts = async () => {\n    if (state.modalVisible) {\n      const adAccounts = await getAdAccounts(fbId, user.xToken);\n      console.log(adAccounts);\n      setState({\n        ...state,\n        adAccounts: adAccounts,\n        paging: {\n          next: adAccounts.paging.next && adAccounts.paging.next,\n          previous: adAccounts.paging.previous && adAccounts.paging.previous,\n        }\n      });\n    }\n  };\n\n  const handlePagination = async (page) => {\n    const adAccounts = await paginateAdAccounts(page)\n    console.log('paginate',adAccounts)\n    setState({\n      ...state,\n      adAccounts: adAccounts,\n      paging: {\n        next: adAccounts.paging.next && adAccounts.paging.next,\n        previous: adAccounts.paging.previous && adAccounts.paging.previous,\n      }\n    });\n  }\n\n  const onSelectionChange = (selectedRowKeys, selectedRows) => {\n    console.log(\"rows\", selectedRows);\n    const selectedInterest = selectedRows.map(interest => {\n      return interest.name;\n    });\n    setState({\n      ...state,\n      selectedRowKeys,\n      selectedInterest,\n      selectedRows\n    });\n  };\n\n  const handleAccountSelect = (id,name) => {\n    console.log('slect', id, name)\n    setState({\n      ...state,\n      selectedAdAccount: {\n        id,\n        name\n      }\n    })\n    setModalVisible(false)\n  }\n\n  const { Option } = Select;\n  const { selectedRowKeys } = state;\n  return (\n    <div id=\"performance\">\n      <Row gutter={16} style={{ width: \"100%\" }}>\n        <Col span={4}>\n          <div className=\"selection\">\n            <div className=\"button item\">\n              <Button onClick={() => setModalVisible(true)} block>\n              {state.selectedAdAccount.name ? state.selectedAdAccount.name : 'Select Ad Account'}\n              </Button>\n            </div>\n            <div className=\"select item\">\n              <Select style={{ width: \"100%\" }} placeholder=\"Select campaign\">\n                <Option value=\"jack\">Jack</Option>\n                <Option value=\"lucy\">Lucy</Option>\n                <Option value=\"disabled\" disabled>\n                  Disabled\n                </Option>\n                <Option value=\"Yiminghe\">yiminghe</Option>\n              </Select>\n            </div>\n            <div className=\"select item\">\n              <Select style={{ width: \"100%\" }} placeholder=\"Select adset\">\n                <Option value=\"jack\">Jack</Option>\n                <Option value=\"lucy\">Lucy</Option>\n                <Option value=\"disabled\" disabled>\n                  Disabled\n                </Option>\n                <Option value=\"Yiminghe\">yiminghe</Option>\n              </Select>\n            </div>\n            <div className=\"select item\">\n              <Select style={{ width: \"100%\" }} placeholder=\"Select ad\">\n                <Option value=\"jack\">Jack</Option>\n                <Option value=\"lucy\">Lucy</Option>\n                <Option value=\"disabled\" disabled>\n                  Disabled\n                </Option>\n                <Option value=\"Yiminghe\">yiminghe</Option>\n              </Select>\n            </div>\n          </div>\n        </Col>\n        <Col span={20}>\n          <div className=\"stats\">\n            <div id=\"chart\"></div>\n            <div>\n              <Table\n                columns={performanceColumns}\n                onSelection={onSelectionChange}\n                selectedRowKeys={selectedRowKeys}\n                className=\"table\"\n              />\n            </div>\n          </div>\n        </Col>\n      </Row>\n      <Modal\n        title=\"Select an Ad account\"\n        centered\n        visible={state.modalVisible}\n        onOk={() => setModalVisible(false)}\n        onCancel={() => setModalVisible(false)}\n        okText=\"Next\"\n        cancelText= \"Previous\"\n        okButtonProps= {{disabled: !(!!state.paging.next), onClick: () => handlePagination(state.paging.next)}}\n        cancelButtonProps= {{disabled: !(!!state.paging.previous), onClick: () => handlePagination(state.paging.previous)}}\n        width={1300}\n      >\n        <div className=\"adAccounts\">\n          <div className=\"inner\">\n          {state.adAccounts\n            ? state.adAccounts.data.map((item, index) => (\n                <div className=\"account\" key={index}>\n                  <AdAccount \n                    name={item.name} \n                    accountId={item.id} \n                    status={item.account_status}\n                    onSelect={handleAccountSelect}/>\n                </div>\n              ))\n            : \"Loading...\"}\n            </div>\n        </div>\n      </Modal>\n      <style jsx>\n        {`\n          #performance {\n            display: flex;\n            position: relative;\n            margin-top: 70px;\n            width: 100%;\n          }\n\n          .selection {\n            display: flex;\n            flex-direction: column;\n            border: 1px solid #ccc;\n            border-radius: 4px;\n            height: auto;\n            padding: 10px;\n          }\n\n          .item {\n            margin-bottom: 30px;\n            width: 100%;\n          }\n          .stats {\n            display: flex;\n            flex-direction: column;\n          }\n\n          .adAccounts {\n            display: flex;\n            justify-content: center;\n          }\n\n          .adAccounts .inner {\n            display: flex;\n            flex-wrap: wrap;\n            width: 90%;\n          }\n\n          .account {\n            min-width: 20%;\n            margin: 10px;\n          }\n        `}\n      </style>\n    </div>\n  );\n}\n\nconst mapStateToProps = state => ({\n  user: state.user.currentUser,\n  fbId: state.user.fbToken.fbId\n});\n\nexport default connect(mapStateToProps)(Performance);\n"],"mappings":"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","sourceRoot":""}