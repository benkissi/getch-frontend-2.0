{"version":3,"file":"static/webpack/static/development/pages/index.js.019eb7b41c262ca36285.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Router from \"next/router\";\nimport { connect } from \"react-redux\";\nimport { Button, Input, Slider } from \"antd\";\nimport { ExportToCsv } from \"export-to-csv\";\nimport { toast } from \"react-toastify\";\nimport Loader from \"react-loader-spinner\";\n\nimport DashboardLayout from \"../components/dashboardLayout\";\nimport InterestTable from \"../components/table\";\n\nimport { tableColumns } from \"../utils/table\";\n\nimport decodeToken from \"../utils/auth\";\nimport { addingCurrentUser } from \"../redux/user/user-actions\";\nimport { searchStart } from \"../redux/search/search-actions\";\n\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\n\nconst Index = (props) => {\n  const [state, setState] = useState({\n    selectedInterest: [],\n    min: null,\n    max: null,\n  });\n  const {\n    token,\n    user,\n    addUser,\n    fbToken,\n    interestData,\n    searchInterest,\n    keyword,\n    interestCount,\n    searching,\n    searchCount,\n  } = props;\n  const { Search } = Input;\n  const router = useRouter();\n\n  useEffect(() => {\n    if (token) {\n      const decoded = decodeToken(token);\n      const { _id, name, email, domain } = decoded;\n      const userData = {\n        id: _id,\n        name,\n        email,\n        domain,\n        xToken: token,\n      };\n      addUser(userData);\n    } else if (user) {\n      console.log(user);\n    } else {\n      router.push(\"/signup\");\n    }\n  }, []);\n\n  useEffect(() => {\n    if (interestData && interestCount) {\n      const max = Math.max.apply(\n        Math,\n        interestData.map((item) => item[\"audience_size\"])\n      );\n      const min = Math.min.apply(\n        Math,\n        interestData.map((item) => item[\"audience_size\"])\n      );\n\n      setState({\n        ...state,\n        max: max,\n        min: min,\n        interests: interestData,\n        interestNumber: interestCount,\n      });\n    }\n  }, [interestData, interestCount]);\n\n  const getInterest = async (value) => {\n    if (searchCount >= 3 && user.plan === \"PL001\") {\n      Router.push(\"/plans\");\n      return;\n    }\n    await searchInterest(fbToken.token, value, 500, user.xToken);\n  };\n\n  const onSelectionChange = (selectedRowKeys, selectedRows) => {\n    console.log(\"rows\", selectedRows);\n    const selectedInterest = selectedRows.map((interest) => {\n      return interest.name;\n    });\n    setState({\n      ...state,\n      selectedRowKeys,\n      selectedInterest,\n      selectedRows,\n    });\n  };\n\n  const onCopy = () => {\n    const { selectedInterest } = state;\n    console.log(\"copy\", selectedInterest);\n    if (selectedInterest.length) {\n      navigator.clipboard.writeText(selectedInterest).then(() => {\n        console.log(\"you copied\", selectedInterest.length);\n\n        toast.success(`You copied ${selectedInterest.length} items`, {\n          position: \"top-right\",\n          autoClose: 5000,\n          hideProgressBar: false,\n          closeOnClick: true,\n          pauseOnHover: true,\n          draggable: true,\n        });\n      });\n    } else {\n      toast.error(`You have not made any selection`, {\n        position: \"top-right\",\n        autoClose: 5000,\n        hideProgressBar: false,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n      });\n    }\n  };\n\n  const options = {\n    fieldSeparator: \",\",\n    quoteStrings: '\"',\n    decimalSeparator: \".\",\n    showLabels: true,\n    showTitle: true,\n    title: \"Interest List\",\n    useTextFile: false,\n    useBom: true,\n    useKeysAsHeaders: true,\n  };\n  const csvExporter = new ExportToCsv(options);\n\n  const handleExport = async () => {\n    // const {selectedRows} = state\n    if (interestData) {\n      let exportArray = [];\n      interestData.forEach((item) => {\n        let readyExport = {};\n        readyExport.id = item.id;\n        readyExport.name = item.name;\n        readyExport.audience = item.audience_size;\n        readyExport.description = item.description;\n        readyExport.topic = item.topic;\n        readyExport.path = JSON.stringify(item.path);\n        readyExport.score = item.relevance;\n        exportArray.push(readyExport);\n      });\n\n      await csvExporter.generateCsv(exportArray);\n      toast.success(`You downloaded ${interestData.length} items`, {\n        position: \"top-right\",\n        autoClose: 5000,\n        hideProgressBar: false,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n      });\n    } else {\n      toast.error(`You have not made any selection`, {\n        position: \"top-right\",\n        autoClose: 3000,\n        hideProgressBar: false,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n      });\n    }\n  };\n\n  const onFilterChange = (value) => {\n    const filtered = interestData.filter(\n      (item) =>\n        item[\"audience_size\"] >= value[0] && item[\"audience_size\"] <= value[1]\n    );\n    setState({\n      ...state,\n      interests: filtered,\n    });\n  };\n\n  const { interests, selectedRowKeys, interestNumber, max, min } = state;\n  return (\n    <div id=\"wrapper\">\n      <div id=\"main-content\">\n        <div className=\"top\">\n          <div className=\"inner\">\n            <Search\n              placeholder=\"Find Facebook interest for a keyword\"\n              enterButton=\"Getch\"\n              size=\"large\"\n              onSearch={(value) => getInterest(value)}\n            />\n            <div className=\"controls\">\n              <div>\n                {interestNumber ? (\n                  <p>\n                    <b>{interestNumber}</b> interest found for \"{keyword}\"\n                  </p>\n                ) : (\n                  \"\"\n                )}\n              </div>\n              <div className=\"filter\">\n                <p>Filter audience</p>\n                <Slider\n                  max={max}\n                  min={min}\n                  range\n                  defaultValue={[min, max]}\n                  onAfterChange={onFilterChange}\n                />\n              </div>\n              <div className=\"actions\">\n                <div className=\"button\">\n                  <Button onClick={onCopy}>Copy</Button>\n                </div>\n                <div className=\"button\">\n                  <Button onClick={handleExport}>Download as CSV</Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div id=\"table\">\n          {searching ? (\n            <div className=\"loader\">\n              <Loader type=\"Bars\" color=\"#4e54c8\" height={100} width={100} />\n            </div>\n          ) : (\n            <InterestTable\n              onSelection={onSelectionChange}\n              selectedRowKeys={selectedRowKeys}\n              className=\"table\"\n              columns={tableColumns}\n              dataSource={interests}\n            />\n          )}\n        </div>\n      </div>\n\n      <style jsx>{`\n        #wrapper {\n          margin: 10px;\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n        }\n        #main-content {\n          margin-top: 30px;\n          flex-grow: 1;\n        }\n        #table {\n          margin-top: 90px;\n          flex-grow: 1;\n        }\n\n        .controls {\n          display: flex;\n          margin-top: 10px;\n          justify-content: space-between;\n        }\n\n        .actions {\n          display: flex;\n        }\n\n        .actions > * {\n          margin-left: 5px;\n        }\n        .loader {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          height: 500px;\n        }\n        .divider {\n          height: 35px;\n          width: 0;\n          border-left: 1px solid #ccc;\n          margin: 0 0 0 5px;\n        }\n\n        .filter {\n          width: 30%;\n        }\n\n        .top {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          position: relative;\n          height: 130px;\n          margin-bottom: 20px;\n          width: 100%;\n          background-color: white;\n        }\n\n        .inner {\n          position: fixed;\n          top: 70px;\n          right: 20px\n          width: 81%;\n          background-color: white;\n          z-index: 100;\n          height: 200px;\n          display: flex;\n          justify-content: center;\n          flex-direction: column;\n        }\n\n        .header {\n          margin-bottom: 20px;\n        }\n\n        :global(.links) {\n          margin-right: 15px;\n        }\n\n        :global(.links img) {\n          width: 20px;\n        }\n\n        @media screen and (max-width: 480px) {\n          .wrapper {\n            width: 100%;\n          }\n        }\n      `}</style>\n    </div>\n  );\n};\n\nIndex.getInitialProps = async function (context) {\n  const token = context.query.at;\n  return {\n    token,\n  };\n};\n\nconst mapStateToProps = (state) => ({\n  user: state.user.currentUser,\n  searching: state.search.loading,\n  searchCount: state.search.searchCount,\n  fbToken: state.user.fbToken,\n  interestData: state.search.interests,\n  interestCount: state.search.interestCount,\n  keyword: state.search.keyword,\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  addUser: (item) => dispatch(addingCurrentUser(item)),\n  searchInterest: (token, value, limit, xToken) =>\n    dispatch(searchStart({ token, value, limit, xToken })),\n});\n\nIndex.Layout = DashboardLayout;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Index);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAHA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBA;AAEA;AACA;AACA;AADA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAWA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAAA;AACA;AADA;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAjBA;AAAA;AACA;AADA;AA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AA3BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAoCA;AACA;AACA;AAAA;AAGA;AAEA;AAFA;AAIA;AACA;AA1KA;AAAA;AAAA;AAAA;AAAA;AA4KA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAhDA;AAAA;AAAA;AAqJA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAGA;AADA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAAA;AACA;AASA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AADA;AAFA;AAAA;AACA;AAKA;AAEA;;;;A","sourceRoot":""}